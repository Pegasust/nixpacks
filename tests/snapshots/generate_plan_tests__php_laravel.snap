---
source: tests/generate_plan_tests.rs
expression: plan
---
{
  "variables": {
    "IS_LARAVEL": "yes",
    "PORT": "80"
  },
  "phases": [
    {
      "name": "setup",
      "nixPackages": [
        {
          "name": "php81"
        },
        {
          "name": "perl"
        },
        {
          "name": "nginx"
        },
        {
          "name": "php81Packages.composer"
        },
        {
          "name": "nodejs"
        },
        {
          "name": "npm-8_x",
          "overlay": "https://github.com/railwayapp/nix-npm-overlay/archive/main.tar.gz"
        }
      ],
      "nixLibraries": [],
      "aptPackages": []
    },
    {
      "name": "install",
      "dependsOn": [
        "setup"
      ],
      "commands": [
        "mkdir -p /var/log/nginx && mkdir -p /var/cache/nginx",
        "composer install",
        "npm i"
      ]
    },
    {
      "name": "build",
      "dependsOn": [
        "install"
      ],
      "commands": [
        "npm run prod"
      ]
    }
  ],
  "startPhase": {
    "cmd": "([ -e /app/storage ] && chmod -R ugo+w /app/storage); perl /assets/transform-config.pl /assets/nginx.template.conf /nginx.conf && echo \"Server starting on port $PORT\" && (php-fpm -y /assets/php-fpm.conf & nginx -c /nginx.conf)"
  }
}
